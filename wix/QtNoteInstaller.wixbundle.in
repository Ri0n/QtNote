<?xml version="1.0"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal">
    <Bundle Name="QtNote" Version="@VERSION_FOR_WIX@" Manufacturer="R-Soft" UpgradeCode="@UPGRADE_CODE@">
        <BootstrapperApplication>
            <bal:WixStandardBootstrapperApplication
                LicenseFile="GPLv3.rtf"
                LogoFile="pen64.ico"
                Theme="rtfLicense" />
            <Payload SourceFile="@LICENSE_RTF@" />
            <Payload SourceFile="@LOGO_FILE@" />
        </BootstrapperApplication>

        <Chain>
            <ExePackage
                Compressed="no"
                DetectCondition="(VCREDIST_INSTALLED=1) AND (VCREDIST_VERSION >= v14.30.30704)"
                DownloadUrl="https://aka.ms/vs/17/release/vc_redist.x64.exe"
                SourceFile="vc_redist.x64.exe"
                InstallArguments="/quiet /norestart"
                Permanent="yes"
                Vital="yes">
                <!-- RemotePayload Description="VC++ 2022 Redistributable" ProductName="MyProductName" Size="size-in-bytes" Version="1.1.1.1" Hash="SHA-1-checksum-here"/-->
            </ExePackage>


            <MsiPackage SourceFile="QtNote.msi" />
        </Chain>
    </Bundle>

    <Fragment>
        <!-- Определяем переменные -->
        <Property Id="VCREDIST_INSTALLED">
            <RegistrySearch
                Id="VCREDIST_INSTALLED"
                Root="HKLM"
                Key="SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x64"
                Name="Installed"
                Type="raw" />
        </Property>
        <Property Id="VCREDIST_VERSION">
            <RegistrySearch
                Id="VCREDIST_VERSION"
                Root="HKLM"
                Key="SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x64"
                Name="Version"
                Type="raw" />
        </Property>
    </Fragment>
</Wix>
